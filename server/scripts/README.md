# MEVç³»ç»Ÿæµ‹è¯•è„šæœ¬

è¿™ä¸ªç›®å½•åŒ…å«äº†MEVç›‘æ§ç³»ç»Ÿçš„æµ‹è¯•å’Œç®¡ç†è„šæœ¬ã€‚

## ğŸ“‹ è„šæœ¬åˆ—è¡¨

### 1. ç”¨æˆ·ç®¡ç†è„šæœ¬ (`user-manager.ts`)
ç”¨äºç®¡ç†ç³»ç»Ÿç”¨æˆ·è´¦æˆ·çš„åˆ›å»ºã€åˆ é™¤å’ŒçŠ¶æ€ç®¡ç†ã€‚

### 2. è®¤è¯æ•°æ®æ¨é€è„šæœ¬ (`auth-pusher.ts`)
å¸¦è®¤è¯åŠŸèƒ½çš„Mockæ•°æ®æ¨é€å™¨ï¼Œç”¨äºæµ‹è¯•ç³»ç»ŸåŠŸèƒ½ã€‚

### 3. ç®€å•æ•°æ®æ¨é€è„šæœ¬ (`mock-pusher.ts`)
ä¸å¸¦è®¤è¯çš„Mockæ•°æ®æ¨é€å™¨ï¼Œç”¨äºåŸºç¡€æµ‹è¯•ã€‚

### 4. æ•°æ®åº“è¿ç§»è„šæœ¬ (`migrate-database.ts`)
ç”¨äºå°†åŸå§‹åç«¯çš„æ•°æ®åº“ä¿¡æ¯è¿ç§»åˆ°é‡æ„åçš„æ•°æ®åº“ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæµ‹è¯•ç”¨æˆ·
```bash
cd server
npm run user:init
```

è¿™ä¼šåˆ›å»ºä»¥ä¸‹æµ‹è¯•ç”¨æˆ·ï¼š
- `admin` / `admin123` (ç®¡ç†å‘˜)
- `test_user` / `test123` (æ™®é€šç”¨æˆ·)
- `pusher` / `pusher123` (æ¨é€ä¸“ç”¨è´¦æˆ·)
- `guest` / `guest123` (è®¿å®¢)

### ç¬¬äºŒæ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡
```bash
npm run dev
```

### ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨æ•°æ®æ¨é€
```bash
# è®¤è¯æ¨¡å¼æ¨é€ï¼ˆæ¨èï¼‰
npm run mock:push

# WebSocketè®¤è¯æ¨¡å¼æ¨é€
npm run mock:push:ws

# ç®€å•æ¨¡å¼æ¨é€ï¼ˆæ— è®¤è¯ï¼‰
npm run mock:push:simple

# ç®€å•WebSocketæ¨¡å¼æ¨é€
npm run mock:push:simple:ws
```

## ğŸ“– è¯¦ç»†ä½¿ç”¨è¯´æ˜

### ç”¨æˆ·ç®¡ç†å‘½ä»¤

#### åˆå§‹åŒ–æµ‹è¯•ç”¨æˆ·
```bash
npm run user:init
```

#### åˆ›å»ºæ–°ç”¨æˆ·
```bash
npm run user:create <ç”¨æˆ·å> <å¯†ç > [ç±»å‹]
```
ç¤ºä¾‹ï¼š
```bash
npm run user:create newuser pass123 admin
```

#### åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·
```bash
npm run user:list
```

#### åˆ é™¤ç”¨æˆ·
```bash
npm run user:delete <ç”¨æˆ·å>
```

#### æ¿€æ´»/ç¦ç”¨ç”¨æˆ·
```bash
npm run user:enable <ç”¨æˆ·å>
npm run user:disable <ç”¨æˆ·å>
```

### æ•°æ®æ¨é€å‘½ä»¤

#### ä½¿ç”¨é»˜è®¤è´¦æˆ·æ¨é€ï¼ˆè®¤è¯æ¨¡å¼ï¼‰
```bash
# APIæ¨¡å¼ï¼ˆæ¨èï¼‰
npm run mock:push

# WebSocketæ¨¡å¼
npm run mock:push:ws
```

#### ä½¿ç”¨è‡ªå®šä¹‰è´¦æˆ·æ¨é€ï¼ˆè®¤è¯æ¨¡å¼ï¼‰
```bash
# APIæ¨¡å¼
npx tsx scripts/auth-pusher.ts api <ç”¨æˆ·å> <å¯†ç >

# WebSocketæ¨¡å¼
npx tsx scripts/auth-pusher.ts ws <ç”¨æˆ·å> <å¯†ç >
```

#### ç®€å•æ¨é€ï¼ˆæ— è®¤è¯ï¼‰
```bash
# APIæ¨¡å¼
npm run mock:push:simple

# WebSocketæ¨¡å¼
npm run mock:push:simple:ws
```

### æ•°æ®åº“è¿ç§»å‘½ä»¤

#### åˆ†æåŸæ•°æ®åº“ç»“æ„
```bash
npm run migrate:analyze <åŸæ•°æ®åº“è·¯å¾„>
```
ç¤ºä¾‹ï¼š
```bash
npm run migrate:analyze ./old_data/mev.db
```

#### æ‰§è¡Œæ•°æ®è¿ç§»
```bash
npm run migrate:run <åŸæ•°æ®åº“è·¯å¾„>
```
ç¤ºä¾‹ï¼š
```bash
npm run migrate:run ./old_data/mev.db
```

#### ç”Ÿæˆè¿ç§»æŠ¥å‘Š
```bash
npm run migrate:report
```

#### ä½¿ç”¨å®Œæ•´è·¯å¾„çš„è¿ç§»å‘½ä»¤
```bash
# åˆ†æåŸæ•°æ®åº“
npx tsx scripts/migrate-database.ts analyze ./path/to/old/database.db

# æ‰§è¡Œè¿ç§»
npx tsx scripts/migrate-database.ts migrate ./path/to/old/database.db

# ç”ŸæˆæŠ¥å‘Š
npx tsx scripts/migrate-database.ts report
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç”¨æˆ·ç±»å‹
- `admin`: ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™
- `normal`: æ™®é€šç”¨æˆ·ï¼ŒåŸºæœ¬æŸ¥çœ‹æƒé™
- `guest`: è®¿å®¢ï¼Œå—é™æƒé™

### æ¨é€é…ç½®
åœ¨è„šæœ¬ä¸­å¯ä»¥ä¿®æ”¹ï¼š
- `PUSH_INTERVAL`: æ¨é€é—´éš”ï¼ˆé»˜è®¤2ç§’ï¼‰
- `API_BASE_URL`: åç«¯APIåœ°å€
- `WS_URL`: WebSocketåœ°å€
- `DEFAULT_CREDENTIALS`: é»˜è®¤ç™»å½•å‡­æ®

### è¿ç§»é…ç½®
- æ”¯æŒè‡ªåŠ¨æ£€æµ‹åŸæ•°æ®åº“è¡¨ç»“æ„
- æ™ºèƒ½å¤„ç†å­—æ®µæ˜ å°„å’Œæ•°æ®è½¬æ¢
- æ”¯æŒå¢é‡è¿ç§»ï¼ˆè·³è¿‡å·²å­˜åœ¨è®°å½•ï¼‰
- æä¾›è¯¦ç»†çš„è¿ç§»æŠ¥å‘Š

## ğŸ“Š æ•°æ®ç±»å‹

### äº¤æ˜“æ•°æ® (70%æ¦‚ç‡)
- é“¾ä¿¡æ¯ï¼šBSC, ETH, SOL
- æ„å»ºè€…ï¼šFlashbots, Eden, BloXrouteç­‰
- æ”¶ç›Šæ•°æ®ï¼šgross, bribe, income, ratio
- æ ‡ç­¾ï¼šArb, Backrun, Blockç­‰

### é¢„è­¦æ•°æ® (20%æ¦‚ç‡)
- é«˜é£é™©äº¤æ˜“
- ç½‘ç»œæ‹¥å µ
- å¥—åˆ©æœºä¼š
- å¼‚å¸¸æ´»åŠ¨
- ä»·æ ¼å¼‚å¸¸
- æµåŠ¨æ€§ä¸è¶³

### æ”¶ç›Šæ•°æ® (10%æ¦‚ç‡)
- ä»Šæ—¥æ”¶ç›Šç»Ÿè®¡
- äº¤æ˜“æ•°é‡ç»Ÿè®¡
- æŒ‰é“¾åˆ†ç±»æ•°æ®

## ğŸ” æ•…éšœæ’é™¤

### æ¨é€å¤±è´¥
1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨
2. ç¡®è®¤ç”¨æˆ·è´¦æˆ·å­˜åœ¨ä¸”å¯†ç æ­£ç¡®ï¼ˆè®¤è¯æ¨¡å¼ï¼‰
3. æ£€æŸ¥ç½‘ç»œè¿æ¥
4. æŸ¥çœ‹åç«¯æ—¥å¿—

### ç™»å½•å¤±è´¥ï¼ˆè®¤è¯æ¨¡å¼ï¼‰
1. è¿è¡Œ `npm run user:list` æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
2. ç¡®è®¤ç”¨æˆ·çŠ¶æ€ä¸ºæ¿€æ´»
3. æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®
4. é‡æ–°åˆ›å»ºç”¨æˆ·è´¦æˆ·

### æ•°æ®åº“è¿ç§»å¤±è´¥
1. ç¡®ä¿åŸæ•°æ®åº“æ–‡ä»¶å­˜åœ¨ä¸”å¯è¯»
2. æ£€æŸ¥æ–°æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
3. ç¡®è®¤è¡¨ç»“æ„å·²åˆ›å»ºï¼ˆè¿è¡Œ `npm run user:init`ï¼‰
4. æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
5. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

### TypeScriptç¼–è¯‘é”™è¯¯
1. ç¡®ä¿å®‰è£…äº†æ‰€æœ‰ä¾èµ–ï¼š`npm install`
2. æ£€æŸ¥TypeScriptç‰ˆæœ¬å…¼å®¹æ€§
3. æ¸…ç†å¹¶é‡æ–°å®‰è£…ï¼š`rm -rf node_modules && npm install`

## ğŸ“ è¾“å‡ºç¤ºä¾‹

### ç”¨æˆ·ç®¡ç†è¾“å‡º
```
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ
âœ… ç”¨æˆ·åˆ›å»ºæˆåŠŸ: admin (admin)
âœ… ç”¨æˆ·åˆ›å»ºæˆåŠŸ: pusher (admin)
âœ… æµ‹è¯•ç”¨æˆ·åˆ›å»ºå®Œæˆ
```

### è®¤è¯æ•°æ®æ¨é€è¾“å‡º
```
ğŸ¯ MEVè®¤è¯Mockæ•°æ®æ¨é€å™¨
==========================
ğŸ‘¤ ä½¿ç”¨è´¦æˆ·: pusher

ğŸ” æ­£åœ¨ç™»å½•ç”¨æˆ·: pusher
âœ… ç™»å½•æˆåŠŸ: pusher (admin)
ğŸš€ è®¤è¯Mockæ•°æ®æ¨é€å™¨å¯åŠ¨...
ğŸ“¡ ç›®æ ‡API: http://localhost:3000/api
â±ï¸  æ¨é€é—´éš”: 2000ms
---
âœ… äº¤æ˜“æ¨é€æˆåŠŸ: BSC - $0.0797
âš ï¸  é¢„è­¦æ¨é€æˆåŠŸ: ETH - ç½‘ç»œæ‹¥å µ
âœ… äº¤æ˜“æ¨é€æˆåŠŸ: SOL - $0.0234
```

### æ•°æ®åº“è¿ç§»è¾“å‡º
```
ğŸ¯ MEVæ•°æ®åº“è¿ç§»å·¥å…·
====================
ğŸš€ å¼€å§‹æ•°æ®åº“è¿ç§»...
ğŸ“‚ åŸæ•°æ®åº“: ./old_data/mev.db
ğŸ“‚ æ–°æ•°æ®åº“: ./data/mev.db
==================================================
âœ… åŸæ•°æ®åº“è¿æ¥æˆåŠŸ
âœ… æ–°æ•°æ®åº“è¿æ¥æˆåŠŸ

ğŸ”„ å¼€å§‹è¿ç§»ç”¨æˆ·æ•°æ®...
ğŸ“Š æ‰¾åˆ° 4 ä¸ªç”¨æˆ·è®°å½•
âœ… ç”¨æˆ·è¿ç§»æˆåŠŸ: admin (admin)
âœ… ç”¨æˆ·è¿ç§»æˆåŠŸ: test_user (normal)
âœ… ç”¨æˆ·è¿ç§»å®Œæˆ: æˆåŠŸ 4, è·³è¿‡ 0

ğŸ”„ å¼€å§‹è¿ç§»äº¤æ˜“æ•°æ®...
ğŸ“Š æ‰¾åˆ° 1256 ä¸ªäº¤æ˜“è®°å½•
ğŸ“ˆ å·²è¿ç§» 100 ä¸ªäº¤æ˜“è®°å½•...
ğŸ“ˆ å·²è¿ç§» 200 ä¸ªäº¤æ˜“è®°å½•...
...
âœ… äº¤æ˜“è¿ç§»å®Œæˆ: æˆåŠŸ 1256, è·³è¿‡ 0

ğŸ“Š ç”Ÿæˆè¿ç§»æŠ¥å‘Š...
ğŸ“ˆ æ–°æ•°æ®åº“ç»Ÿè®¡:
==============================
ğŸ‘¥ ç”¨æˆ·æ•°é‡: 4
ğŸ’° äº¤æ˜“æ•°é‡: 1256
âš ï¸  é¢„è­¦æ•°é‡: 23
ğŸ“Š æ”¶ç›Šè®°å½•: 45
ğŸ† Topä¿¡æ¯: 3
ğŸ·ï¸  æ ‡ç­¾æ”¶ç›Š: 67
ğŸ“… æœ€æ–°äº¤æ˜“æ—¶é—´: 2025-01-21 21:14:19

ğŸ”— é“¾åˆ†å¸ƒ:
  BSC: 678 ç¬”äº¤æ˜“
  ETH: 345 ç¬”äº¤æ˜“
  SOL: 233 ç¬”äº¤æ˜“

ğŸ‰ æ•°æ®åº“è¿ç§»å®Œæˆï¼
```

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•ç¯å¢ƒä¸“ç”¨**ï¼šè¿™äº›è„šæœ¬ä»…ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ
2. **å¯†ç å®‰å…¨**ï¼šç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨å¼ºå¯†ç 
3. **æƒé™æ§åˆ¶**ï¼šåˆç†åˆ†é…ç”¨æˆ·æƒé™
4. **æ•°æ®å¤‡ä»½**ï¼šè¿ç§»å‰åŠ¡å¿…å¤‡ä»½åŸæ•°æ®åº“
5. **æ•°æ®æ¸…ç†**ï¼šå®šæœŸæ¸…ç†æµ‹è¯•æ•°æ®

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š
1. æŸ¥çœ‹åç«¯æœåŠ¡æ—¥å¿—
2. æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
3. éªŒè¯ç½‘ç»œè¿æ¥
4. é‡æ–°åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ
5. ä½¿ç”¨åˆ†æå‘½ä»¤æ£€æŸ¥åŸæ•°æ®åº“ç»“æ„

## ğŸ”„ è„šæœ¬å¯¹æ¯”

| è„šæœ¬ | è®¤è¯ | ç”¨é€” | æ¨èåœºæ™¯ |
|------|------|------|----------|
| `auth-pusher.ts` | âœ… | å®Œæ•´åŠŸèƒ½æµ‹è¯• | ç”Ÿäº§ç¯å¢ƒæ¨¡æ‹Ÿ |
| `mock-pusher.ts` | âŒ | åŸºç¡€åŠŸèƒ½æµ‹è¯• | å¼€å‘è°ƒè¯• |
| `user-manager.ts` | N/A | ç”¨æˆ·ç®¡ç† | è´¦æˆ·ç»´æŠ¤ |
| `migrate-database.ts` | N/A | æ•°æ®è¿ç§» | ç³»ç»Ÿå‡çº§ |

## ğŸ“‹ è¿ç§»æ³¨æ„äº‹é¡¹

### è¿ç§»å‰å‡†å¤‡
1. **å¤‡ä»½åŸæ•°æ®åº“**ï¼š`cp old_mev.db old_mev.db.backup`
2. **ç¡®è®¤æ–°æ•°æ®åº“è¡¨ç»“æ„**ï¼šè¿è¡Œ `npm run user:init`
3. **æ£€æŸ¥ç£ç›˜ç©ºé—´**ï¼šç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´å­˜å‚¨è¿ç§»æ•°æ®
4. **åœæ­¢ç›¸å…³æœåŠ¡**ï¼šé¿å…æ•°æ®å†²çª

### è¿ç§»è¿‡ç¨‹
1. **å…ˆåˆ†æ**ï¼šä½¿ç”¨ `analyze` å‘½ä»¤äº†è§£åŸæ•°æ®åº“ç»“æ„
2. **å°æ‰¹é‡æµ‹è¯•**ï¼šå¯ä»¥ä¿®æ”¹è„šæœ¬é™åˆ¶è¿ç§»æ•°é‡è¿›è¡Œæµ‹è¯•
3. **ç›‘æ§è¿›åº¦**ï¼šè§‚å¯Ÿè¿ç§»è¿‡ç¨‹ä¸­çš„è¾“å‡ºä¿¡æ¯
4. **å¤„ç†é”™è¯¯**ï¼šè®°å½•å¹¶å¤„ç†è¿ç§»è¿‡ç¨‹ä¸­çš„é”™è¯¯

### è¿ç§»åéªŒè¯
1. **æ£€æŸ¥æ•°æ®å®Œæ•´æ€§**ï¼šä½¿ç”¨ `report` å‘½ä»¤ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š
2. **åŠŸèƒ½æµ‹è¯•**ï¼šå¯åŠ¨ç³»ç»Ÿè¿›è¡ŒåŸºæœ¬åŠŸèƒ½æµ‹è¯•
3. **æ€§èƒ½æµ‹è¯•**ï¼šæ£€æŸ¥è¿ç§»åçš„ç³»ç»Ÿæ€§èƒ½
4. **æ•°æ®ä¸€è‡´æ€§**ï¼šå¯¹æ¯”å…³é”®æ•°æ®çš„ä¸€è‡´æ€§

# PM2æ—¥å¿—ç®¡ç†è„šæœ¬

æœ¬ç›®å½•åŒ…å«äº†å®Œæ•´çš„PM2æ—¥å¿—è½®è½¬å’Œç®¡ç†è„šæœ¬ã€‚

## ğŸ“ è„šæœ¬æ–‡ä»¶

- `setup-logrotate.sh` - PM2 logrotateå®‰è£…é…ç½®è„šæœ¬
- `manage-logs.sh` - æ—¥å¿—ç®¡ç†ç»´æŠ¤è„šæœ¬

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è®¾ç½®è„šæœ¬æƒé™

```bash
chmod +x server/scripts/*.sh
```

### 2. å®‰è£…é…ç½®logrotate

```bash
./server/scripts/setup-logrotate.sh
```

è„šæœ¬ä¼šå¼•å¯¼ä½ é€‰æ‹©ç¯å¢ƒé…ç½®ï¼š
- **å¼€å‘ç¯å¢ƒ**: 5Mæ–‡ä»¶ï¼Œä¿ç•™7å¤©ï¼Œæ— å‹ç¼©
- **æµ‹è¯•ç¯å¢ƒ**: 10Mæ–‡ä»¶ï¼Œä¿ç•™14å¤©ï¼Œå‹ç¼©
- **ç”Ÿäº§ç¯å¢ƒ**: 50Mæ–‡ä»¶ï¼Œä¿ç•™30å¤©ï¼Œå‹ç¼©
- **é«˜è´Ÿè½½ç¯å¢ƒ**: 100Mæ–‡ä»¶ï¼Œä¿ç•™60å¤©ï¼Œå‹ç¼©
- **è‡ªå®šä¹‰é…ç½®**: è‡ªå®šä¹‰æ‰€æœ‰å‚æ•°

### 3. ç®¡ç†æ—¥å¿—æ–‡ä»¶

```bash
# æŸ¥çœ‹å¸®åŠ©
./server/scripts/manage-logs.sh help

# æŸ¥çœ‹æ—¥å¿—çŠ¶æ€
./server/scripts/manage-logs.sh status

# æŸ¥çœ‹æ—¥å¿—å¤§å°
./server/scripts/manage-logs.sh size

# å¼ºåˆ¶è½®è½¬æ—¥å¿—
./server/scripts/manage-logs.sh rotate

# æ¸…ç©ºæ—¥å¿—
./server/scripts/manage-logs.sh clean

# å®æ—¶ç›‘æ§
./server/scripts/manage-logs.sh monitor
```

## ğŸ“‹ è¯¦ç»†åŠŸèƒ½

### setup-logrotate.sh

**åŠŸèƒ½:**
- âœ… è‡ªåŠ¨æ£€æŸ¥PM2å®‰è£…çŠ¶æ€
- âœ… å®‰è£…pm2-logrotateæ¨¡å—
- âœ… æä¾›5ç§é¢„è®¾é…ç½®ç¯å¢ƒ
- âœ… æ”¯æŒå®Œå…¨è‡ªå®šä¹‰é…ç½®
- âœ… è‡ªåŠ¨éªŒè¯å®‰è£…ç»“æœ
- âœ… åˆ›å»ºå¿…è¦çš„æ—¥å¿—ç›®å½•
- âœ… é‡å¯ç›¸å…³PM2è¿›ç¨‹

**é…ç½®é€‰é¡¹:**
- å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§å¤§å°
- å†å²æ—¥å¿—ä¿ç•™æ•°é‡
- æ˜¯å¦å‹ç¼©æ—§æ—¥å¿—æ–‡ä»¶
- æ—¥å¿—è½®è½¬æ—¶é—´ï¼ˆcronæ ¼å¼ï¼‰
- æ—¥å¿—æ–‡ä»¶å‘½åæ ¼å¼

### manage-logs.sh

**åŠŸèƒ½:**

| å‘½ä»¤ | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| `status` | æ˜¾ç¤ºçŠ¶æ€ | PM2è¿›ç¨‹ã€logrotateæ¨¡å—ã€æ—¥å¿—æ–‡ä»¶çŠ¶æ€ |
| `size` | æ˜¾ç¤ºå¤§å° | æ—¥å¿—ç›®å½•å’Œæ–‡ä»¶å¤§å°ç»Ÿè®¡ |
| `config` | æ˜¾ç¤ºé…ç½® | å½“å‰logrotateé…ç½®å‚æ•° |
| `rotate` | å¼ºåˆ¶è½®è½¬ | ç«‹å³æ‰§è¡Œæ—¥å¿—è½®è½¬ |
| `clean` | æ¸…ç©ºæ—¥å¿— | æ¸…ç©ºæ‰€æœ‰å½“å‰æ—¥å¿—æ–‡ä»¶ |
| `archive` | æ‰‹åŠ¨å½’æ¡£ | å‹ç¼©å½’æ¡£ç°æœ‰æ—¥å¿— |
| `monitor` | å®æ—¶ç›‘æ§ | å®æ—¶æ˜¾ç¤ºæ—¥å¿—å¤§å°å˜åŒ– |
| `backup` | å¤‡ä»½æ—¥å¿— | åˆ›å»ºæ—¥å¿—æ–‡ä»¶å¤‡ä»½ |
| `restore` | æ¢å¤å¤‡ä»½ | ä»å¤‡ä»½æ¢å¤æ—¥å¿—æ–‡ä»¶ |

## ğŸ”§ æ‰‹åŠ¨é…ç½®

å¦‚æœéœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# å®‰è£…æ¨¡å—
pm2 install pm2-logrotate

# é…ç½®å‚æ•°
pm2 set pm2-logrotate:max_size 50M           # æœ€å¤§æ–‡ä»¶å¤§å°
pm2 set pm2-logrotate:retain 30              # ä¿ç•™æ–‡ä»¶æ•°é‡
pm2 set pm2-logrotate:compress true          # å‹ç¼©æ—§æ–‡ä»¶
pm2 set pm2-logrotate:rotateInterval '0 2 * * *'  # è½®è½¬æ—¶é—´
pm2 set pm2-logrotate:dateFormat 'YYYY-MM-DD_HH-mm-ss'  # æ—¶é—´æ ¼å¼

# æŸ¥çœ‹é…ç½®
pm2 conf pm2-logrotate

# é‡å¯åº”ç”¨
pm2 restart mev-server
```

## ğŸ“Š ç›‘æ§å‘½ä»¤

```bash
# æŸ¥çœ‹æ—¥å¿—
pm2 logs mev-server

# æŸ¥çœ‹æœ€å100è¡Œ
pm2 logs mev-server --lines 100

# å®æ—¶æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs mev-server --err

# æ¸…ç©ºæ‰€æœ‰æ—¥å¿—
pm2 flush

# é‡æ–°åŠ è½½æ—¥å¿—
pm2 reloadLogs

# å¼ºåˆ¶è½®è½¬
pm2 trigger pm2-logrotate rotate
```

## ğŸ“ æ—¥å¿—æ–‡ä»¶ä½ç½®

```
server/logs/
â”œâ”€â”€ err.log         # é”™è¯¯æ—¥å¿—
â”œâ”€â”€ out.log         # è¾“å‡ºæ—¥å¿—
â”œâ”€â”€ combined.log    # åˆå¹¶æ—¥å¿—
â””â”€â”€ archive/        # å½’æ¡£ç›®å½•
    â””â”€â”€ 20231201_120000/
        â”œâ”€â”€ err.log.gz
        â”œâ”€â”€ out.log.gz
        â””â”€â”€ combined.log.gz
```

## ğŸš¨ æ•…éšœæ’é™¤

### é—®é¢˜1: pm2-logrotateå®‰è£…å¤±è´¥
```bash
# æ¸…ç†PM2æ¨¡å—ç¼“å­˜
pm2 kill
pm2 uninstall pm2-logrotate
pm2 install pm2-logrotate
```

### é—®é¢˜2: æ—¥å¿—è½®è½¬ä¸å·¥ä½œ
```bash
# æ£€æŸ¥æ¨¡å—çŠ¶æ€
pm2 list | grep logrotate

# æ£€æŸ¥é…ç½®
pm2 conf pm2-logrotate

# æ‰‹åŠ¨è§¦å‘è½®è½¬
pm2 trigger pm2-logrotate rotate
```

### é—®é¢˜3: æ—¥å¿—æ–‡ä»¶è¿‡å¤§
```bash
# ç«‹å³æ¸…ç©º
pm2 flush

# æˆ–æ‰‹åŠ¨å½’æ¡£
./server/scripts/manage-logs.sh archive
```

## ğŸ”„ å®šæœŸç»´æŠ¤

å»ºè®®è®¾ç½®å®šæœŸç»´æŠ¤è®¡åˆ’ï¼š

```bash
# æ·»åŠ åˆ°crontab
# æ¯å¤©æ£€æŸ¥æ—¥å¿—å¤§å°
0 9 * * * cd /path/to/project && ./server/scripts/manage-logs.sh size

# æ¯å‘¨å¤‡ä»½æ—¥å¿—
0 2 * * 0 cd /path/to/project && ./server/scripts/manage-logs.sh backup

# æ¯æœˆæ¸…ç†æ—§å¤‡ä»½
0 3 1 * * find /path/to/project/backups/logs -name "*.tar.gz" -mtime +90 -delete
```

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. PM2æ˜¯å¦æ­£ç¡®å®‰è£…
2. Node.jsç‰ˆæœ¬æ˜¯å¦å…¼å®¹
3. è„šæœ¬æ˜¯å¦æœ‰æ‰§è¡Œæƒé™
4. æ—¥å¿—ç›®å½•æ˜¯å¦æœ‰å†™æƒé™

æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ: [PM2å®˜æ–¹æ–‡æ¡£](https://pm2.keymetrics.io/)